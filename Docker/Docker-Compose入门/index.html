<!DOCTYPE HTML>
<html lang="null">
<head><meta name="generator" content="Hexo 3.8.0">
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="带你走进美丽的墨尔本">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <link rel="dns-prefetch" href="http://blog.ozairs.com">
    <!--SEO-->

    <meta name="keywords" content="Docker">


    <meta name="description" content="Compose 是一个用户定义和运行多个容器的 Docker 应用程序。在 Compose 中你可以使用 YAML 文件来配置你的应用服务。然后，只需要一个简单的命令，就可以创建并启动你配置的所...">



<meta name="robots" content="all">
<meta name="google" content="all">
<meta name="googlebot" content="all">
<meta name="verify" content="all">

    <!--Title-->


<title>Docker-Compose入门 | 带你走进美丽的墨尔本</title>


    <link rel="alternate" href="/atom.xml" title="带你走进美丽的墨尔本" type="application/atom+xml">


    <link rel="icon" href="/favicon.ico">

    



<link rel="stylesheet" href="/css/bootstrap.min.css?rev=3.3.7">
<link rel="stylesheet" href="/css/font-awesome.min.css?rev=4.5.0">
<link rel="stylesheet" href="/css/style.css?rev=@@hash">




    
	<div class="hide">
		<script type="text/javascript">
			var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan class='cnzz_stat_icon_1263868967 hide' %3E%3Cscript%20src%3D%22https%3A%2F%2Fs95.cnzz.com%2Fz_stat.php%3Fweb_id%3D1272564536%22%3E%3C%2Fscript%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s19.cnzz.com/z_stat.php%3Fid%3D1263868967%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));
		</script>
	</div>





	<script>
		(function(i, s, o, g, r, a, m) {
		    i['GoogleAnalyticsObject'] = r;
		    i[r] = i[r] || function() {
		        (i[r].q = i[r].q || []).push(arguments)
		    }, i[r].l = 1 * new Date();
		    a = s.createElement(o),
		    m = s.getElementsByTagName(o)[0];
		    a.async = 1;
		    a.src = g;
		    m.parentNode.insertBefore(a, m)
		})(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
		ga('create', 'UA-136105852-1', 'auto');
		ga('send', 'pageview');
	</script>


    

</head>

</html>
<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->

<body>
    <header class="main-header">
    <div class="main-header-box">
        <a class="header-avatar" href="/" title="Mark Wu">
            <img src="/img/avatar.jpg" alt="logo头像" class="img-responsive center-block">
        </a>
        <div class="branding">
        	<!--<h2 class="text-hide">Snippet主题,从未如此简单有趣</h2>-->
            
                 <img src="/img/branding.png" alt="Snippet 博客主题" class="img-responsive center-block">
            
    	</div>
    </div>
</header>
    <nav class="main-navigation">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed pull-right" data-toggle="collapse" data-target="#main-menu" id="mnav">
                    <span class="sr-only"></span>
                        <i class="fa fa-bars"></i>
                    </span>
                    <a class="navbar-brand" href="http://blog.ozairs.com">带你走进美丽的墨尔本</a>
                </div>
                <div class="collapse navbar-collapse" id="main-menu">
                    <ul class="menu">
                        
                            <li role="presentation" class="text-center">
                                <a href="/"><i class="fa "></i>主页</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/电影"><i class="fa "></i>电影</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/AWS"><i class="fa "></i>AWS</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/Ansible"><i class="fa "></i>Ansible</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/Cloud-Service"><i class="fa "></i>Cloud Service</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/Security"><i class="fa "></i>Security</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/DevOps"><i class="fa "></i>DevOps</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/Docker"><i class="fa "></i>Docker</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/Jenkins"><i class="fa "></i>Jenkins</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/Kubernetes"><i class="fa "></i>Kubernetes</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/Python"><i class="fa "></i>Python</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/Serverless"><i class="fa "></i>Serverless</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/Terraform"><i class="fa "></i>Terraform</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/archives/"><i class="fa "></i>时间轴</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="https://156709406.gitbook.io/markwu100/"><i class="fa "></i>《奔跑吧～Terraform》中文版</a>
                            </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content m-post">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="Docker-Compose入门">
            
	            Docker-Compose入门
            
        </h1>
        <div class="post-meta">
    
        <span class="categories-meta fa-wrap">
            <i class="fa fa-folder-open-o"></i>
            <a class="category-link" href="/categories/Docker/">Docker</a>
        </span>
    

    
        <span class="fa-wrap">
            <i class="fa fa-tags"></i>
            <span class="tags-meta">
                
                    <a class="tag-link" href="/tags/Docker/">Docker</a>
                
            </span>
        </span>
    

    
        
        <span class="fa-wrap">
            <i class="fa fa-clock-o"></i>
            <span class="date-meta">2019/03/16</span>
        </span>
        
    
</div>
            
            
            <p class="fa fa-exclamation-triangle warning">
                本文于<strong>323</strong>天之前发表，文中内容可能已经过时。
            </p>
        
    </div>
    
    <div class="post-body post-content">
        <p>Compose 是一个用户定义和运行多个容器的 Docker 应用程序。在 Compose 中你可以使用 YAML 文件来配置你的应用服务。然后，只需要一个简单的命令，就可以创建并启动你配置的所有服务。</p>
<p>使用 Compose 基本会有如下三步流程：</p>
<ol>
<li>在 Dockfile 中定义你的应用环境，使其可以在任何地方复制。</li>
<li>在 docker-compose.yml 中定义组成应用程序的服务，以便它们可以在隔离的环境中一起运行。</li>
<li>最后，运行<code>dcoker-compose up</code>，Compose 将启动并运行整个应用程序。</li>
</ol>
<h2 id="开始使用-Docker-Compose"><a href="#开始使用-Docker-Compose" class="headerlink" title="开始使用 Docker Compose"></a>开始使用 Docker Compose</h2><p>这里面将会在 Docker Compose 中构建一个简单的 Python 程序。应用程序将使用 Flask 框架，并在 Redis 中维护一个计数器。</p>
<p><strong>先决条件</strong></p>
<p>确认你已经安装了 Docker Engine 与 Docker Compose。你不需要安装 Python 或者 Redis，这两个都会在 Docker <a href="https://www.baidu.com/s?wd=%E9%95%9C%E5%83%8F&amp;tn=24004469_oem_dg&amp;rsv_dl=gh_pl_sl_csd" target="_blank" rel="noopener">镜像</a>中提供。</p>
<h3 id="第一步：定义应用依赖"><a href="#第一步：定义应用依赖" class="headerlink" title="第一步：定义应用依赖"></a>第一步：定义应用依赖</h3><ol>
<li><p>为项目创建目录</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> mkdir composetest</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> composetest12</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>创建一个名为 app.py 的文件，并将如下内容粘贴进去：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">cache = redis.Redis(host=<span class="string">'redis'</span>, port=<span class="number">6379</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_hit_count</span><span class="params">()</span>:</span></span><br><span class="line">   retries = <span class="number">5</span></span><br><span class="line">   <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">       <span class="keyword">try</span>:</span><br><span class="line">           <span class="keyword">return</span> cache.incr(<span class="string">'hits'</span>)</span><br><span class="line">       <span class="keyword">except</span> redis.exceptions.ConnectionError <span class="keyword">as</span> exc:</span><br><span class="line">           <span class="keyword">if</span> retries == <span class="number">0</span>:</span><br><span class="line">               <span class="keyword">raise</span> exc</span><br><span class="line">           retries -= <span class="number">1</span></span><br><span class="line">           time.sleep(<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">()</span>:</span></span><br><span class="line">   count = get_hit_count()</span><br><span class="line">   <span class="keyword">return</span> <span class="string">'Hello World! I have been seen &#123;&#125; times.\n'</span>.format(count)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">   app.run(host=<span class="string">"0.0.0.0"</span>, debug=<span class="keyword">True</span>)<span class="number">1234567891011121314151617181920212223242526</span></span><br></pre></td></tr></table></figure>
<p>在这个例子中，redis 就是应用网络中 redis 容器的主机名。我们使用 Redis 的默认端口 6379。</p>
</li>
<li><p>在你的项目路径下创建另外一个叫做 requirements.txt 的文件，并将如下内容粘贴进去：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flask</span><br><span class="line">redis12</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="第二步：创建-Dockerfile"><a href="#第二步：创建-Dockerfile" class="headerlink" title="第二步：创建 Dockerfile"></a>第二步：创建 Dockerfile</h3><p>在这一步中，你需要编写一个 Dockerfile 来构建一个 Docker 镜像。这个镜像包含 Python 应用的所有依赖，也包含 Python 其本身。</p>
<p>在你的项目路径下创建一个 Dockerfile 文件，并将如下内容粘贴进去：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> python:<span class="number">3.4</span>-alpine</span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> . /code</span></span><br><span class="line"><span class="bash">WORKDIR /code</span></span><br><span class="line"><span class="bash">RUN pip install -r requirements.txt</span></span><br><span class="line"><span class="bash">CMD [<span class="string">"python"</span>, <span class="string">"app.py"</span>]12345</span></span><br></pre></td></tr></table></figure>
<p>这会告诉容器：</p>
<ul>
<li>构建一个基于 Python 3.4 的镜像</li>
<li>把当前目录添加到镜像中的 /code 路径下</li>
<li>把工作路径设置成 /code</li>
<li>安装 Python 依赖</li>
<li>设置容器的默认命令为 <code>python app.py</code></li>
</ul>
<p>有关如何编写 Dockerfiles 的更多信息，请参考 <a href="https://docs.docker.com/engine/tutorials/dockerimages/#building-an-image-from-a-dockerfile" target="_blank" rel="noopener">Docker user guide</a> 与 <a href="https://docs.docker.com/engine/reference/builder/" target="_blank" rel="noopener">Dockerfile reference</a>。</p>
<h3 id="第三步：在-Compose-文件中定义一个服务"><a href="#第三步：在-Compose-文件中定义一个服务" class="headerlink" title="第三步：在 Compose 文件中定义一个服务"></a>第三步：在 Compose 文件中定义一个服务</h3><p>在工作路径下创建一个叫做 docker-compose.yml 并粘贴如下内容：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'3'</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"><span class="attr">  web:</span></span><br><span class="line"><span class="attr">    build:</span> <span class="string">.</span></span><br><span class="line"><span class="attr">    ports:</span></span><br><span class="line"><span class="bullet">     -</span> <span class="string">"5000:5000"</span></span><br><span class="line"><span class="attr">  redis:</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">"redis:alpine"</span><span class="number">12345678</span></span><br></pre></td></tr></table></figure>
<p>这个 Compose 文件中定义了两个服务 web 与 redis。此 Web 服务：</p>
<ul>
<li>使用当前目录 Dockerfile 构建出来的镜像</li>
<li>将容器上暴露的5000端口转发到主机的5000端口。我们使用 Flask Web 服务器的默认端口 5000。</li>
</ul>
<p>而 Redis 服务使用从 Docker Hub 注册表中拉取的公有镜像。</p>
<h3 id="第四步：在-Compose-中构建并运行你的应用"><a href="#第四步：在-Compose-中构建并运行你的应用" class="headerlink" title="第四步：在 Compose 中构建并运行你的应用"></a>第四步：在 Compose 中构建并运行你的应用</h3><ol>
<li><p>在你的项目路径下通过 <code>docker-compose up</code> 命令启动你的应用。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker-compose up</span></span><br><span class="line">Creating network "composetest_default" with the default driver</span><br><span class="line">Creating composetest_web_1 ...</span><br><span class="line">Creating composetest_redis_1 ...</span><br><span class="line">Creating composetest_web_1</span><br><span class="line">Creating composetest_redis_1 ... done</span><br><span class="line">Attaching to composetest_web_1, composetest_redis_1</span><br><span class="line">web_1    |  * Running on http://0.0.0.0:5000/ (Press CTRL+C to quit)</span><br><span class="line">redis_1  | 1:C 17 Aug 22:11:10.480 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span><br><span class="line">redis_1  | 1:C 17 Aug 22:11:10.480 # Redis version=4.0.1, bits=64, commit=00000000, modified=0, pid=1, just started</span><br><span class="line">redis_1  | 1:C 17 Aug 22:11:10.480 # Warning: no config file specified, using the default config. In order to specify a config file use redis-server /path/to/redis.conf</span><br><span class="line">web_1    |  * Restarting with stat</span><br><span class="line">redis_1  | 1:M 17 Aug 22:11:10.483 * Running mode=standalone, port=6379.</span><br><span class="line">redis_1  | 1:M 17 Aug 22:11:10.483 # WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.</span><br><span class="line">web_1    |  * Debugger is active!</span><br><span class="line">redis_1  | 1:M 17 Aug 22:11:10.483 # Server initialized</span><br><span class="line">redis_1  | 1:M 17 Aug 22:11:10.483 # WARNING you have Transparent Huge Pages (THP) support enabled in your kernel. This will create latency and memory usage issues with Redis. To fix this issue run the command 'echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled' as root, and add it to your /etc/rc.local in order to retain the setting after a reboot. Redis must be restarted after THP is disabled.</span><br><span class="line">web_1    |  * Debugger PIN: 330-787-903</span><br><span class="line">redis_1  | 1:M 17 Aug 22:11:10.483 * Ready to accept connections12345678910111213141516171819</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>Compose 拉取一个 Redis 镜像，以你自己的代码构建一个镜像，并启动你定义的服务。在这种情况下，代码在构建时静态拷贝到镜像中。</p>
<ol>
<li><p>在浏览器中输入 <a href="http://0.0.0.0:5000/" target="_blank" rel="noopener">http://0.0.0.0:5000</a> 查看应用的运行情况。</p>
<p>你将在你的浏览器中看到如下信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello World! I have been seen 1 times.1</span><br></pre></td></tr></table></figure>
</li>
<li><p>刷新一下浏览器，数值将会增加。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello World! I have been seen 2 times.1</span><br></pre></td></tr></table></figure>
</li>
<li><p>切换到另外一个容器，输入 <code>docker image ls</code> 列举所有本地镜像。</p>
<p>镜像列表中将返回 reidis 与 web。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker image ls</span></span><br><span class="line">REPOSITORY              TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">composetest_web         latest              e2c21aa48cc1        4 minutes ago       93.8MB</span><br><span class="line">python                  3.4-alpine          84e6077c7ab6        7 days ago          82.5MB</span><br><span class="line">redis                   alpine              9d8fa9aa0e5b        3 weeks ago         27.5MB12345</span><br></pre></td></tr></table></figure>
<p>你也可以通过 <code>docker inspect &lt;tag or id&gt;</code> 来检查镜像。</p>
</li>
<li><p>停止镜像，即可以在你的项目路径下使用 <code>docker-compose down</code> ，也可以在原始的终端上使用 CTRL+C 停止当前启动着的应用。</p>
</li>
</ol>
<h3 id="第五步：编辑-Compose-文件添加一个绑定挂载"><a href="#第五步：编辑-Compose-文件添加一个绑定挂载" class="headerlink" title="第五步：编辑 Compose 文件添加一个绑定挂载"></a>第五步：编辑 Compose 文件添加一个绑定挂载</h3><p>在你的项目路径下编辑 docker-compose.yml 为 web 服务添加一个绑定挂载：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'3'</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"><span class="attr">  web:</span></span><br><span class="line"><span class="attr">    build:</span> <span class="string">.</span></span><br><span class="line"><span class="attr">    ports:</span></span><br><span class="line"><span class="bullet">     -</span> <span class="string">"5000:5000"</span></span><br><span class="line"><span class="attr">    volumes:</span></span><br><span class="line"><span class="bullet">     -</span> <span class="string">.:/code</span></span><br><span class="line"><span class="attr">  redis:</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">"redis:alpine"</span><span class="number">12345678910</span></span><br></pre></td></tr></table></figure>
<p>这个新的 volumes 键将当前路径（项目路径）与容器中的 /code 路径挂载到一起，允许你及时修改代码而不用重新构建镜像。</p>
<h3 id="第六步：重新构建并在-Compose-中运行应用"><a href="#第六步：重新构建并在-Compose-中运行应用" class="headerlink" title="第六步：重新构建并在 Compose 中运行应用"></a>第六步：重新构建并在 Compose 中运行应用</h3><p>在你的项目路径下，输入 <code>docker-compose up</code> 命令使用更新后的 Compose 文件构建应用并启动。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker-compose up</span></span><br><span class="line">Creating network "composetest_default" with the default driver</span><br><span class="line">Creating composetest_web_1 ...</span><br><span class="line">Creating composetest_redis_1 ...</span><br><span class="line">Creating composetest_web_1</span><br><span class="line">Creating composetest_redis_1 ... done</span><br><span class="line">Attaching to composetest_web_1, composetest_redis_1</span><br><span class="line">web_1    |  * Running on http://0.0.0.0:5000/ (Press CTRL+C to quit)</span><br><span class="line">...123456789</span><br></pre></td></tr></table></figure>
<p>再次检查 Web 浏览器中的 Hello World 消息，然后刷新以查看计数增量。</p>
<h3 id="第七步：更新应用程序"><a href="#第七步：更新应用程序" class="headerlink" title="第七步：更新应用程序"></a>第七步：更新应用程序</h3><p>因为应用程序的代码通过 volume 挂载到容器中，你可以更改其代码并立即查看更改，而不必重新生成镜像。</p>
<ol>
<li><p>修改 app.py 中的欢迎语并保存。例如，将 Hello World！ 改成 Hello from Docker!:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="string">'Hello from Docker! I have been seen &#123;&#125; times.\n'</span>.format(count)<span class="number">1</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>刷新你的浏览器。欢迎语已经更新，而计数器仍然在增长。</p>
</li>
</ol>
<h3 id="第八步：尝试一些其它命令"><a href="#第八步：尝试一些其它命令" class="headerlink" title="第八步：尝试一些其它命令"></a>第八步：尝试一些其它命令</h3><p>如果你希望你的应用程序在后台运行，你可以将 <code>-d</code> 标记传递给 <code>docker-compose up</code> 并使用 <code>docker-compose ps</code> 来查看当前运行的应用。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker-compose up -d</span></span><br><span class="line">Starting composetest_redis_1...</span><br><span class="line">Starting composetest_web_1...</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> docker-compose ps</span></span><br><span class="line">Name                 Command            State       Ports</span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line">composetest_redis_1   /usr/local/bin/run         Up</span><br><span class="line">composetest_web_1     /bin/sh -c python app.py   Up      5000-&gt;5000/tcp123456789</span><br></pre></td></tr></table></figure>
<p><code>docker-compose run</code> 命令允许你为你的应用程序运行一次性命令。例如，查看哪些环境变量可以用于 web 服务：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker-compose run web env1</span></span><br></pre></td></tr></table></figure>
<p>通过 <code>docker-compose --help</code> 查看所有可用的命令。</p>
<p>如果你使用 <code>docker-compose up -d</code> 启动了 Compose，你可能希望在它们运行完成后停止服务：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker-compose stop1</span></span><br></pre></td></tr></table></figure>
<p>你可以停掉所有一切，使用 down 命令完全移除容器。传递 —volumes 还可以删除 Redis 容器中所使用的数据卷。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker-compose down --volumes</span></span><br></pre></td></tr></table></figure>
    </div>
    
        <div class="reward" ontouchstart="">
    <div class="reward-wrap">赏
        <div class="reward-box">
            
            
                <span class="reward-type">
                    <img class="wechat" src="/img/wechatpay.jpg"><b>微信打赏</b>
                </span>
            
        </div>
    </div>
    <p class="reward-tip">坚持原创分享，您的支持将鼓励我继续创作！</p>
</div>


    
    <div class="post-footer">
        <div>
            
                转载声明：商业转载请联系作者获得授权,非商业转载请注明出处 © <a href="" target="_blank">Mark</a>
            
        </div>
        <div>
            
        </div>
    </div>
</article>

<div class="article-nav prev-next-wrap clearfix">
    
        <a href="/Docker/Docker-Swarm入门一篇文章就够了/" class="pre-post btn btn-default" title="Docker Swarm入门一篇文章就够了">
            <i class="fa fa-angle-left fa-fw"></i><span class="hidden-lg">上一篇</span>
            <span class="hidden-xs">Docker Swarm入门一篇文章就够了</span>
        </a>
    
    
        <a href="/AWS/在Amazon-ECS上部署Docker容器/" class="next-post btn btn-default" title="在Amazon ECS上部署Docker容器">
            <span class="hidden-lg">下一篇</span>
            <span class="hidden-xs">在Amazon ECS上部署Docker容器</span><i class="fa fa-angle-right fa-fw"></i>
        </a>
    
</div>


    <div id="comments">
        
	
    <div id="vcomments" class="valine"></div>
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="/assets/valine.min.js"></script>

    <script>
        new Valine({
            av: AV,
            el: '#vcomments',
            appId: 'undefined',
            appKey: 'undefined',
            placeholder: '说点什么吧',
            notify: false,
            verify: false,
            avatar: 'mm',
            meta: 'nick,mail'.split(','),
            pageSize: '10',
            path: window.location.pathname,
            lang: 'null'.toLowerCase()
        })
    </script>


    </div>





                </main>
                
                    <aside id="article-toc" role="navigation" class="col-md-4">
    <div class="widget">
        <h3 class="title">Table of Contents</h3>
        
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#开始使用-Docker-Compose"><span class="toc-text">开始使用 Docker Compose</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#第一步：定义应用依赖"><span class="toc-text">第一步：定义应用依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第二步：创建-Dockerfile"><span class="toc-text">第二步：创建 Dockerfile</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第三步：在-Compose-文件中定义一个服务"><span class="toc-text">第三步：在 Compose 文件中定义一个服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第四步：在-Compose-中构建并运行你的应用"><span class="toc-text">第四步：在 Compose 中构建并运行你的应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第五步：编辑-Compose-文件添加一个绑定挂载"><span class="toc-text">第五步：编辑 Compose 文件添加一个绑定挂载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第六步：重新构建并在-Compose-中运行应用"><span class="toc-text">第六步：重新构建并在 Compose 中运行应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第七步：更新应用程序"><span class="toc-text">第七步：更新应用程序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第八步：尝试一些其它命令"><span class="toc-text">第八步：尝试一些其它命令</span></a></li></ol></li></ol>
        
    </div>
</aside>

                
            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>

<a id="back-to-top" class="icon-btn hide">
	<i class="fa fa-chevron-up"></i>
</a>




    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="busuanzi">
    
</div>

            </div>
            <div class="col-sm-12">
                <span>Copyright &copy; 2017
                </span> |
                <span>
                    Powered by <a href="//hexo.io" class="copyright-links" target="_blank" rel="nofollow">Hexo</a>
                </span> |
                <span>
                    Theme by <a href="//github.com/shenliyang/hexo-theme-snippet.git" class="copyright-links" target="_blank" rel="nofollow">Snippet</a>
                </span>
            </div>
        </div>
    </div>
</div>







<script src="/js/app.js?rev=@@hash"></script>

</body>
</html>