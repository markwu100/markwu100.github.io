<!DOCTYPE HTML>
<html lang="null">
<head><meta name="generator" content="Hexo 3.8.0">
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="Cloud Service一站通">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <link rel="dns-prefetch" href="http://blog.ozairs.com">
    <!--SEO-->

    <meta name="keywords" content="Jenkins">


    <meta name="description" content="在互联网时代，对于每一家公司，软件开发和发布的重要性不言而喻，目前已经形成一套标准的流程，最重要的组成部分就是持续集成（CI）及持续部署、交付（CD）。本文基于Jenkins+Docker+Gi...">



<meta name="robots" content="all">
<meta name="google" content="all">
<meta name="googlebot" content="all">
<meta name="verify" content="all">

    <!--Title-->


<title>Jenkins与Docker的自动化CI/CD实战 | Cloud Service一站通</title>


    <link rel="alternate" href="/atom.xml" title="Cloud Service一站通" type="application/atom+xml">


    <link rel="icon" href="/favicon.ico">

    



<link rel="stylesheet" href="/css/bootstrap.min.css?rev=3.3.7">
<link rel="stylesheet" href="/css/font-awesome.min.css?rev=4.5.0">
<link rel="stylesheet" href="/css/style.css?rev=@@hash">




    
	<div class="hide">
		<script type="text/javascript">
			var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan class='cnzz_stat_icon_1263868967 hide' %3E%3Cscript%20src%3D%22https%3A%2F%2Fs95.cnzz.com%2Fz_stat.php%3Fweb_id%3D1272564536%22%3E%3C%2Fscript%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s19.cnzz.com/z_stat.php%3Fid%3D1263868967%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));
		</script>
	</div>





	<script>
		(function(i, s, o, g, r, a, m) {
		    i['GoogleAnalyticsObject'] = r;
		    i[r] = i[r] || function() {
		        (i[r].q = i[r].q || []).push(arguments)
		    }, i[r].l = 1 * new Date();
		    a = s.createElement(o),
		    m = s.getElementsByTagName(o)[0];
		    a.async = 1;
		    a.src = g;
		    m.parentNode.insertBefore(a, m)
		})(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
		ga('create', 'UA-136105852-1', 'auto');
		ga('send', 'pageview');
	</script>


    

</head>

</html>
<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->

<body>
    <header class="main-header">
    <div class="main-header-box">
        <a class="header-avatar" href="/" title="Mark Wu">
            <img src="/img/avatar.jpg" alt="logo头像" class="img-responsive center-block">
        </a>
        <div class="branding">
        	<!--<h2 class="text-hide">Snippet主题,从未如此简单有趣</h2>-->
            
                 <img src="/img/branding.png" alt="Snippet 博客主题" class="img-responsive center-block">
            
    	</div>
    </div>
</header>
    <nav class="main-navigation">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed pull-right" data-toggle="collapse" data-target="#main-menu" id="mnav">
                    <span class="sr-only"></span>
                        <i class="fa fa-bars"></i>
                    </span>
                    <a class="navbar-brand" href="http://blog.ozairs.com">Cloud Service一站通</a>
                </div>
                <div class="collapse navbar-collapse" id="main-menu">
                    <ul class="menu">
                        
                            <li role="presentation" class="text-center">
                                <a href="/"><i class="fa "></i>Main</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/AWS"><i class="fa "></i>AWS</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/Ansible"><i class="fa "></i>Ansible</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/Cloud-Service"><i class="fa "></i>Cloud Service</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/Security"><i class="fa "></i>Security</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/DevOps"><i class="fa "></i>DevOps</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/Docker"><i class="fa "></i>Docker</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/Jenkins"><i class="fa "></i>Jenkins</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/Kubernetes"><i class="fa "></i>Kubernetes</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/Python"><i class="fa "></i>Python</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/categories/Terraform"><i class="fa "></i>Terraform</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/archives/"><i class="fa "></i>Archives</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="https://156709406.gitbook.io/markwu100/"><i class="fa "></i>《Go Terraform》Chinese Version</a>
                            </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content m-post">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="Jenkins与Docker的自动化CI/CD实战">
            
	            Jenkins与Docker的自动化CI/CD实战
            
        </h1>
        <div class="post-meta">
    
        <span class="categories-meta fa-wrap">
            <i class="fa fa-folder-open-o"></i>
            <a class="category-link" href="/categories/DevOps/">DevOps</a>
        </span>
    

    
        <span class="fa-wrap">
            <i class="fa fa-tags"></i>
            <span class="tags-meta">
                
                    <a class="tag-link" href="/tags/Jenkins/">Jenkins</a>
                
            </span>
        </span>
    

    
        
        <span class="fa-wrap">
            <i class="fa fa-clock-o"></i>
            <span class="date-meta">2019/03/17</span>
        </span>
        
    
</div>
            
            
            <p class="fa fa-exclamation-triangle warning">
                本文于<strong>373</strong>天之前发表，文中内容可能已经过时。
            </p>
        
    </div>
    
    <div class="post-body post-content">
        <p>在互联网时代，对于每一家公司，软件开发和发布的重要性不言而喻，目前已经形成一套标准的流程，最重要的组成部分就是持续集成（CI）及持续部署、交付（CD）。本文基于Jenkins+Docker+Git实现一套CI自动化发布流程。</p>
<h2 id="一、发布流程设计"><a href="#一、发布流程设计" class="headerlink" title="一、发布流程设计"></a>一、发布流程设计</h2><p><img src="/DevOps/Jenkins与Docker的自动化CI-CD实战/1.png" alt=""></p>
<p><img src="/DevOps/Jenkins与Docker的自动化CI-CD实战/1.1.png" alt=""></p>
<p>工作流程：**</p>
<ol>
<li>开发人员提交代码到Git版本仓库；</li>
<li>Jenkins人工/定时触发项目构建；</li>
<li>Jenkins拉取代码、代码编码、打包镜像、推送到镜像仓库；</li>
<li>Jenkins在Docker主机创建容器并发布。</li>
</ol>
<p>环境规划如下：</p>
<table>
<thead>
<tr>
<th>角色</th>
<th>IP</th>
</tr>
</thead>
<tbody>
<tr>
<td>Jenkins/Docker</td>
<td>192.168.0.217</td>
</tr>
<tr>
<td>Docker</td>
<td>192.168.0.218</td>
</tr>
<tr>
<td>Git/Registry</td>
<td>192.168.0.219</td>
</tr>
</tbody>
</table>
<p>操作系统：CentOS7.4</p>
<h2 id="二、部署Git仓库"><a href="#二、部署Git仓库" class="headerlink" title="二、部署Git仓库"></a>二、部署Git仓库</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># yum install git -y</span><br></pre></td></tr></table></figure>
<ol>
<li><p>创建Git用户并设置密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># useradd git</span><br><span class="line"># passwd git</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建仓库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># su - git</span><br><span class="line"># mkdir solo.git</span><br><span class="line"># cd solo.git</span><br><span class="line"># git --bare init</span><br></pre></td></tr></table></figure>
</li>
<li><p>访问创建的这个仓库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># git clone git@192.168.0.212:/home/git/solo.git</span><br></pre></td></tr></table></figure>
<h2 id="三、准备Jenkins环境"><a href="#三、准备Jenkins环境" class="headerlink" title="三、准备Jenkins环境"></a>三、准备Jenkins环境</h2><p>Jenkins是一个开源软件项目，是基于Java开发的一种持续集成工具，用于代码编译、部署、测试等工作。 Jenkins也是一个跨平台的，大多数主流的平台都支持，而且安装很简单，我们这里以部署war包方式安装它。<br>官网下载地址：<a href="https://jenkins.io/download/" target="_blank" rel="noopener">https://jenkins.io/download/</a> </p>
<p>在安装前需要具备Java环境，安装方式如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># tar zxf jdk-8u45-linux-x64.tar.gz </span><br><span class="line"># mv jdk-8u45-linux-x64 /usr/local/jdk1.8 </span><br><span class="line"># vi /etc/profile </span><br><span class="line">JAVA_HOME=/usr/local/jdk1.8 </span><br><span class="line">PATH=$PATH:$JAVA_HOME/bin</span><br><span class="line">CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar </span><br><span class="line">export JAVA_HOME PATH CLASSPATH</span><br><span class="line"># source /etc/profile</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>在192.168.0.217主机安装Jenkins，下载Tomcat二进制包将war包到webapps下即可：**</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># wget http://mirrors.jenkins.io/war-stable/latest/jenkins.war </span><br><span class="line"># wget http://mirrors.shu.edu.cn/apache/tomcat/tomcat-8/v8.5.32/bin/apache-tomcat-8.5.32.tar.gz </span><br><span class="line"># tar zxf apache-tomcat-8.5.32.tar.gz </span><br><span class="line"># mv apache-tomcat-8.5.32 /usr/local/tomcat-jenkins </span><br><span class="line"># rm /usr/local/tomcat-jenkins/webapps/* -rf </span><br><span class="line"># unzip jenkins.war -d /usr/local/tomcat-jenkins/webapps/ROOT </span><br><span class="line"># cd /usr/local/tomcat-jenkins/bin/ </span><br><span class="line"># ./startup.sh </span><br><span class="line"># tail ../logs/catalina.out -f </span><br><span class="line">... </span><br><span class="line">Jenkins initial setup is required. An admin user has been created and a password generated. </span><br><span class="line">Please use the following password to proceed to installation: </span><br><span class="line"></span><br><span class="line">a5f1f7c167fd4b8ab62f9497d32d97db </span><br><span class="line"></span><br><span class="line">This may also be found at: /root/.jenkins/secrets/initialAdminPassword ...</span><br></pre></td></tr></table></figure>
<p>部署成功，访问Jenkins：<a href="http://ip:8080/" target="_blank" rel="noopener">http://ip:8080</a></p>
<p>第一步：输入上面日志输出的密码：a5f1f7c167fd4b8ab62f9497d32d97db，或者从本机/root/.jenkins/secrets/initialAdminPassword文件获取，点击继续<br>第二步：点击“选择插件来安装”<br>第三步：保持默认，点击继续<br>第四步：创建管理员用户，保存并完成<br>第五步：设置Jenkins访问地址，保持默认，点击保存完成</p>
<p>安装完成，开始使用Jenkins：<br><img src="/DevOps/Jenkins与Docker的自动化CI-CD实战/2.png" alt=""></p>
<h2 id="四、部署私有镜像仓库"><a href="#四、部署私有镜像仓库" class="headerlink" title="四、部署私有镜像仓库"></a>四、部署私有镜像仓库</h2><p>Docker Hub作为Docker默认官方公共镜像；如果想自己搭建私有镜像仓库，官方也提供registry镜像，使得搭建私有仓库非常简单。<br>在192.168.0.219部署：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># docker run -d -v /opt/registry:/var/lib/registry -p 5000:5000 --restart=always --name registry registry</span><br></pre></td></tr></table></figure>
<p>接下来测试registry可用性。<br>由于Docker CLI默认以HTTPS访问，而部署的registry并未提供HTTPS，因此，需要在pull镜像的Docker主机（192.168.0.217，192.168.0.218）添加HTTP可信任：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> # vi /etc/docker/daemon.json </span><br><span class="line">&#123;&quot;insecure-registries&quot;:[&quot;192.168.0.219:5000&quot;]&#125;</span><br><span class="line"># service docker restart</span><br></pre></td></tr></table></figure>
<h2 id="五、安装Docker"><a href="#五、安装Docker" class="headerlink" title="五、安装Docker"></a>五、安装Docker</h2><p>在192.168.0.217/192.168.0.218/192.168.0.219主机安装Docker，如下：</p>
<ol>
<li><p>安装依赖包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># yum install -y yum-utils device-mapper-persistent-data lvm2</span><br></pre></td></tr></table></figure>
</li>
<li><p>添加Docker软件包源：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># yum-config-manager \</span><br><span class="line">--add-repo \</span><br><span class="line">https://download.docker.com/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装Docker CE</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># yum install docker-ce -y</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置加速器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># curl -sSL https://get.daocloud.io/daotools/set_mirror.sh | sh -s http://bc437cce.m.daocloud.io</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动并开机启动</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># systemctl start docker</span><br><span class="line"># systemctl enable docker</span><br></pre></td></tr></table></figure>
<h2 id="六、构建Tomcat基础镜像"><a href="#六、构建Tomcat基础镜像" class="headerlink" title="六、构建Tomcat基础镜像"></a>六、构建Tomcat基础镜像</h2><p>JAVA程序必须有JDK环境才可以运行，为了减少镜像大小及提高性能，这里直接把JDK放到宿主机上，容器以挂载形式使用。<br>在192.168.0.217/192.168.0.218安装JDK：</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># tar zxvf jdk-8u45-linux-x64.tar.gz </span><br><span class="line"># mv jdk-8u45-linux-x64 /usr/local/jdk1.8</span><br></pre></td></tr></table></figure>
<p>Tomcat基础镜像Dockerfile：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># cat Dockerfile</span><br><span class="line">FROM centos:7</span><br><span class="line">MAINTAINER www.aliangedu.com</span><br><span class="line"></span><br><span class="line">ENV VERSION=8.5.32</span><br><span class="line">ENV JAVA_HOME /usr/local/jdk</span><br><span class="line"></span><br><span class="line">RUN yum install wget -y</span><br><span class="line"></span><br><span class="line">RUN wget http://mirrors.shu.edu.cn/apache/tomcat/tomcat-8/v$&#123;VERSION&#125;/bin/apache-tomcat-$&#123;VERSION&#125;.tar.gz &amp;&amp; \</span><br><span class="line">    tar zxf apache-tomcat-$&#123;VERSION&#125;.tar.gz &amp;&amp; \</span><br><span class="line">    mv apache-tomcat-$&#123;VERSION&#125; /usr/local/tomcat &amp;&amp; \</span><br><span class="line">    rm -rf apache-tomcat-$&#123;VERSION&#125;.tar.gz /usr/local/tomcat/webapps/* &amp;&amp; \</span><br><span class="line">    mkdir /usr/local/tomcat/webapps/ROOT</span><br><span class="line"></span><br><span class="line">EXPOSE 8080</span><br><span class="line">CMD [&quot;catalina.sh&quot;, &quot;run&quot;]</span><br></pre></td></tr></table></figure>
<p>构建镜像并上传到registry：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># docker build -t 192.168.0.219:5000/tomcat-85 -f Dockerfile .</span><br><span class="line"># docker push 192.168.0.219:5000/tomcat-85</span><br></pre></td></tr></table></figure>
<h2 id="七、Jenkins配置全局工具配置"><a href="#七、Jenkins配置全局工具配置" class="headerlink" title="七、Jenkins配置全局工具配置"></a>七、Jenkins配置全局工具配置</h2><p>主页面 -&gt; 系统管理 -&gt; 全局工具配置</p>
<p>指定JDK、Maven路径，Git保持默认：<br><img src="/DevOps/Jenkins与Docker的自动化CI-CD实战/3.png" alt=""><br>如果Jenkins主机没有git命令，需要安装Git：<br><code># yum install git -y</code></p>
<h2 id="八、Jenkins安装必要插件"><a href="#八、Jenkins安装必要插件" class="headerlink" title="八、Jenkins安装必要插件"></a>八、Jenkins安装必要插件</h2><p><strong>1. Jenkins安装必要插件</strong><br>主页面 -&gt; 系统管理 -&gt;管理插件：<br><img src="/DevOps/Jenkins与Docker的自动化CI-CD实战/4.png" alt=""><br>安装SSH与Git Parameter插件。</p>
<p>插件说明：</p>
<ul>
<li>SSH：用于SSH远程Docker主机执行Shell命令</li>
<li>Git Parameter：动态获取Git仓库Branch、Tag</li>
</ul>
<p><strong>2. 配置SSH插件</strong><br><strong>第一步：先创建一个用于连接Docker主机的凭据。</strong><br>主页面 -&gt; 凭据 -&gt; 系统 -&gt; 右击全局凭据 -&gt; 添加凭据：<br><img src="/DevOps/Jenkins与Docker的自动化CI-CD实战/5.png" alt="">输入连接Docker主机的用户名和密码：<br><img src="/DevOps/Jenkins与Docker的自动化CI-CD实战/6.png" alt=""><br><strong>第二步：添加SSH远程主机</strong><br>主页面 -&gt; 系统管理 -&gt; 系统设置 -&gt; SSH remote hosts：<br><img src="/DevOps/Jenkins与Docker的自动化CI-CD实战/7.png" alt=""></p>
<h2 id="九、上传JAVA项目代码到Git仓库"><a href="#九、上传JAVA项目代码到Git仓库" class="headerlink" title="九、上传JAVA项目代码到Git仓库"></a>九、上传JAVA项目代码到Git仓库</h2><p>从Github拉取开源JAVA博客系统solo：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># git clone https://github.com/b3log/solo</span><br><span class="line"># cd solo</span><br><span class="line">移除旧的推送地址，添加新的：</span><br><span class="line"># git remote remove origin </span><br><span class="line"># git remote add origin git@192.168.0.219:/home/git/solo.git</span><br><span class="line">提交代码到Git仓库并创建tag：</span><br><span class="line"># touch src/main/webapp/a.html</span><br><span class="line"># git add .</span><br><span class="line"># git commit -m “a”</span><br><span class="line">创建标签：</span><br><span class="line"># git tag 1.0.0</span><br><span class="line">推送到Git服务器：</span><br><span class="line"># git push origin 1.0.0</span><br></pre></td></tr></table></figure>
<h2 id="十、Jenkins创建项目并发布测试"><a href="#十、Jenkins创建项目并发布测试" class="headerlink" title="十、Jenkins创建项目并发布测试"></a>十、Jenkins创建项目并发布测试</h2><p>主页面 -&gt; 新建任务 -&gt; 输入任务名称，构建一个Maven项目：<br><img src="/DevOps/Jenkins与Docker的自动化CI-CD实战/8.png" alt=""><br>注意：如果没有显示“构建一个Maven项目”选项，需要在管理插件里安装“Maven Integration plugin”插件。<br>配置Git参数化构建：<br><img src="/DevOps/Jenkins与Docker的自动化CI-CD实战/9.png" alt=""><br>动态获取Git仓库tag，与用户交互选择Tag发布：<br><img src="/DevOps/Jenkins与Docker的自动化CI-CD实战/10.png" alt=""><br>指定项目Git仓库地址：<br><img src="/DevOps/Jenkins与Docker的自动化CI-CD实战/11.png" alt=""><br>修改*/master为$Tag，Tag是上面动态获取的变量名，表示根据用户选择打代码版本。</p>
<p>设置maven构建命令选项：<br><img src="/DevOps/Jenkins与Docker的自动化CI-CD实战/12.png" alt=""></p>
<p>利用pom.xml文件构建项目。<br>在Jenkins本机镜像构建与推送到镜像仓库，并SSH远程连接到Docker主机使用推送的镜像创建容器：<br><img src="/DevOps/Jenkins与Docker的自动化CI-CD实战/13.png" alt=""><br>上图中，在Jenkins主机执行的Shell命令如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">REPOSITORY=192.168.0.219:5000/solo:$&#123;Tag&#125;</span><br><span class="line"># 构建镜像</span><br><span class="line">cat &gt; Dockerfile &lt;&lt; EOF</span><br><span class="line">FROM 192.168.0.219:5000/tomcat-85:latest</span><br><span class="line">RUN rm -rf /usr/local/tomcat/webapps/ROOT</span><br><span class="line">COPY target/*.war /usr/local/tomcat/webapps/ROOT.war</span><br><span class="line">CMD [&quot;catalina.sh&quot;, &quot;run&quot;]</span><br><span class="line">EOF</span><br><span class="line">docker build -t $REPOSITORY .</span><br><span class="line"># 上传镜像</span><br><span class="line">docker push $REPOSITORY</span><br></pre></td></tr></table></figure>
<p>上图中，SSH远程Docker主机执行的Shell命令如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">REPOSITORY=192.168.0.219:5000/solo:$&#123;Tag&#125;</span><br><span class="line"># 部署</span><br><span class="line">docker rm -f blog-solo |true</span><br><span class="line">docker image rm $REPOSITORY |true</span><br><span class="line">docker container run -d --name blog-solo -v /usr/local/jdk1.8:/usr/local/jdk -p 88:8080 $REPOSITORY</span><br></pre></td></tr></table></figure>
<p>注：容器名称blog-solo，暴露宿主机端口88，即使用宿主机IP:88访问blog-solo项目。<br>blog-solo项目已配置完成，开始构建：</p>
<p>选择tag，开始构建：</p>
<p><img src="/DevOps/Jenkins与Docker的自动化CI-CD实战/14.png" alt=""></p>
<p><img src="/DevOps/Jenkins与Docker的自动化CI-CD实战/15.png" alt=""></p>
<p>点击左下角构建历史里，右击第一个查看控制台输出：</p>
<p><img src="/DevOps/Jenkins与Docker的自动化CI-CD实战/16.png" alt=""></p>
<p><img src="/DevOps/Jenkins与Docker的自动化CI-CD实战/17.png" alt=""></p>
<p>浏览器访问solo项目：<a href="http://192.168.0.218:88/" target="_blank" rel="noopener">http://192.168.0.218:88</a><br><img src="/DevOps/Jenkins与Docker的自动化CI-CD实战/18.png" alt=""><br>如果输出上述页面说明是正常的，页面没有加载成功样式，需要修改下项目里访问地址。</p>
<p>至此，自动化CI环境搭建完成，你可以模拟提交代码并打tag测试自动化发布流程。</p>

    </div>
    
        <div class="reward" ontouchstart="">
    <div class="reward-wrap">赏
        <div class="reward-box">
            
            
                <span class="reward-type">
                    <img class="wechat" src="/img/wechatpay.jpg"><b>微信打赏</b>
                </span>
            
        </div>
    </div>
    <p class="reward-tip">坚持原创分享，您的支持将鼓励我继续创作！</p>
</div>


    
    <div class="post-footer">
        <div>
            
                转载声明：商业转载请联系作者获得授权,非商业转载请注明出处 © <a href="" target="_blank">Mark</a>
            
        </div>
        <div>
            
        </div>
    </div>
</article>

<div class="article-nav prev-next-wrap clearfix">
    
        <a href="/Kubernetes/为什么我们抛弃ECS而选择了Kubernetes/" class="pre-post btn btn-default" title="为什么我们抛弃ECS而选择了Kubernetes">
            <i class="fa fa-angle-left fa-fw"></i><span class="hidden-lg">上一篇</span>
            <span class="hidden-xs">为什么我们抛弃ECS而选择了Kubernetes</span>
        </a>
    
    
        <a href="/DevOps/把一个Node-js-web应用程序给Docker化/" class="next-post btn btn-default" title="把一个Node.js web应用程序给Docker化">
            <span class="hidden-lg">下一篇</span>
            <span class="hidden-xs">把一个Node.js web应用程序给Docker化</span><i class="fa fa-angle-right fa-fw"></i>
        </a>
    
</div>


    <div id="comments">
        
	
    <div id="vcomments" class="valine"></div>
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="/assets/valine.min.js"></script>

    <script>
        new Valine({
            av: AV,
            el: '#vcomments',
            appId: 'undefined',
            appKey: 'undefined',
            placeholder: '说点什么吧',
            notify: false,
            verify: false,
            avatar: 'mm',
            meta: 'nick,mail'.split(','),
            pageSize: '10',
            path: window.location.pathname,
            lang: 'null'.toLowerCase()
        })
    </script>


    </div>





                </main>
                
                    <aside id="article-toc" role="navigation" class="col-md-4">
    <div class="widget">
        <h3 class="title">Table of Contents</h3>
        
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#一、发布流程设计"><span class="toc-text">一、发布流程设计</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#二、部署Git仓库"><span class="toc-text">二、部署Git仓库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#三、准备Jenkins环境"><span class="toc-text">三、准备Jenkins环境</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#四、部署私有镜像仓库"><span class="toc-text">四、部署私有镜像仓库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#五、安装Docker"><span class="toc-text">五、安装Docker</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#六、构建Tomcat基础镜像"><span class="toc-text">六、构建Tomcat基础镜像</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#七、Jenkins配置全局工具配置"><span class="toc-text">七、Jenkins配置全局工具配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#八、Jenkins安装必要插件"><span class="toc-text">八、Jenkins安装必要插件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#九、上传JAVA项目代码到Git仓库"><span class="toc-text">九、上传JAVA项目代码到Git仓库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#十、Jenkins创建项目并发布测试"><span class="toc-text">十、Jenkins创建项目并发布测试</span></a></li></ol>
        
    </div>
</aside>

                
            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>

<a id="back-to-top" class="icon-btn hide">
	<i class="fa fa-chevron-up"></i>
</a>




    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="busuanzi">
    
</div>

            </div>
            <div class="col-sm-12">
                <span>Copyright &copy; 2017
                </span> |
                <span>
                    Powered by <a href="//hexo.io" class="copyright-links" target="_blank" rel="nofollow">Hexo</a>
                </span> |
                <span>
                    Theme by <a href="//github.com/shenliyang/hexo-theme-snippet.git" class="copyright-links" target="_blank" rel="nofollow">Snippet</a>
                </span>
            </div>
        </div>
    </div>
</div>







<script src="/js/app.js?rev=@@hash"></script>

</body>
</html>